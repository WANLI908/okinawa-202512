<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025 æ²–ç¹©å…¨å®¶ç¦ ğŸŒº</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { font-family: 'M PLUS Rounded 1c', sans-serif; background-color: #FFF8E1; -webkit-tap-highlight-color: transparent; }
        .shisa-header { background: linear-gradient(135deg, #FFAB91 0%, #FFCC80 100%); border-radius: 0 0 30px 30px; box-shadow: 0 4px 15px rgba(255, 167, 38, 0.3); }
        .card { background: white; border-radius: 20px; border: 2px solid #FFE0B2; transition: all 0.3s; overflow: hidden; }
        .card.active { border-color: #FF7043; box-shadow: 0 8px 20px rgba(255, 112, 67, 0.2); transform: scale(1.01); }
        
        /* æ¨™ç±¤é¡è‰² */
        .tag-eat { background: #FFECB3; color: #E65100; }
        .tag-spot { background: #B2EBF2; color: #006064; }
        .tag-trans { background: #E1BEE7; color: #4A148C; }
        .tag-hotel { background: #DCEDC8; color: #33691E; }
        
        /* åº•éƒ¨å°èˆª */
        .bottom-nav { background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(10px); border-top: 1px solid #FFE0B2; }
        .nav-item.active { color: #FF7043; transform: translateY(-2px); }
        .nav-item { color: #90A4AE; transition: all 0.2s; }
        
        /* è§’è‰²é ­åƒé¸å–® */
        .role-btn { transition: transform 0.2s; }
        .role-btn:active { transform: scale(0.95); }
        .role-selected { ring: 4px solid #FF7043; background: #FFF3E0; }

        /* å½ˆçª— */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; }
        .modal-overlay.open { display: flex; opacity: 1; }
        .modal-content { background: white; padding: 2rem; border-radius: 20px; width: 85%; max-height: 80vh; overflow-y: auto; text-align: center; animation: popIn 0.3s ease-out; }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body class="pb-28">

    <!-- é ‚éƒ¨æ¨™é¡Œ -->
    <div class="shisa-header sticky top-0 z-50 p-4 flex justify-between items-center text-white">
        <div>
            <h1 class="text-xl font-bold flex items-center gap-2">
                æ²–ç¹©å…¨å®¶ç¦ 
                <span id="current-role-badge" onclick="clearRole()" class="text-xs bg-white/20 px-2 py-1 rounded cursor-pointer hover:bg-white/40">åˆ‡æ›èº«ä»½</span>
            </h1>
            <p id="header-date" class="text-xs opacity-90 mt-1">æº–å‚™å‡ºç™¼ï¼</p>
        </div>
        <div class="text-3xl" onclick="toggleDevMode()">ğŸ¦</div>
    </div>

    <!-- èº«ä»½é¸æ“‡é é¢ (Overlay) -->
    <div id="role-selector" class="fixed inset-0 bg-[#FFF8E1] z-[60] flex flex-col items-center justify-center p-6 space-y-8 hidden">
        <div class="text-center">
            <h2 class="text-3xl font-bold text-orange-600 mb-2">ä½ æ˜¯èª°ï¼Ÿ</h2>
            <p class="text-gray-500">é¸æ“‡èº«ä»½ä»¥æä¾›æœ€é©åˆä½ çš„è³‡è¨Š</p>
        </div>
        <div class="grid grid-cols-2 gap-4 w-full max-w-sm">
            <button onclick="selectRole('driver')" class="role-btn bg-white p-6 rounded-2xl shadow-lg border-2 border-orange-100 flex flex-col items-center gap-2">
                <div class="text-4xl">ğŸš—</div>
                <div class="font-bold text-gray-700">å¦¹å¦¹ (é§•é§›)</div>
                <div class="text-xs text-gray-400">MapCodeã€äº¤é€š</div>
            </button>
            <button onclick="selectRole('copilot')" class="role-btn bg-white p-6 rounded-2xl shadow-lg border-2 border-orange-100 flex flex-col items-center gap-2">
                <div class="text-4xl">ğŸ—ºï¸</div>
                <div class="font-bold text-gray-700">çˆ¸çˆ¸ (å‰¯é§•)</div>
                <div class="text-xs text-gray-400">åœè»Šå ´ã€å°èˆªè¼”åŠ©</div>
            </button>
            <button onclick="selectRole('tourist')" class="role-btn bg-white p-6 rounded-2xl shadow-lg border-2 border-orange-100 flex flex-col items-center gap-2">
                <div class="text-4xl">ğŸ“¸</div>
                <div class="font-bold text-gray-700">åª½åª½ (éŠå®¢)</div>
                <div class="text-xs text-gray-400">ç¾é£Ÿã€ç¾ç…§ã€è©•åƒ¹</div>
            </button>
            <button onclick="selectRole('admin')" class="role-btn bg-white p-6 rounded-2xl shadow-lg border-2 border-orange-100 flex flex-col items-center gap-2">
                <div class="text-4xl">ğŸ“</div>
                <div class="font-bold text-gray-700">æˆ‘ (ä¸»æª)</div>
                <div class="text-xs text-gray-400">é ç´„ã€æ™‚é–“æŒæ§</div>
            </button>
        </div>
    </div>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <div id="app" class="p-4 space-y-6"></div>

    <!-- èœå–®æ”¾å¤§å½ˆçª— -->
    <div id="dish-modal" class="modal-overlay" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="text-gray-500 text-sm mb-2">è«‹æŒ‡çµ¦åº—å“¡çœ‹</div>
            <h2 id="modal-jp" class="text-3xl font-bold text-gray-900 mb-2 leading-relaxed"></h2>
            <p id="modal-cn" class="text-lg text-orange-600 font-medium mb-4"></p>
            <div id="modal-img" class="w-full h-48 bg-gray-200 rounded-lg mb-4 bg-cover bg-center"></div>
            <button onclick="closeModal()" class="bg-gray-200 text-gray-700 px-6 py-2 rounded-full font-bold w-full">é—œé–‰</button>
        </div>
    </div>

    <!-- åº•éƒ¨å°èˆª -->
    <div class="bottom-nav fixed bottom-0 w-full flex justify-around p-2 z-50 pb-6">
        <button onclick="switchTab('home')" id="btn-home" class="nav-item active flex flex-col items-center w-1/4">
            <i class="fa-solid fa-house text-lg mb-1"></i>
            <span class="text-[10px] font-bold">è¡Œç¨‹</span>
        </button>
        <button onclick="switchTab('shopping')" id="btn-shopping" class="nav-item flex flex-col items-center w-1/4">
            <i class="fa-solid fa-bag-shopping text-lg mb-1"></i>
            <span class="text-[10px] font-bold">å¿…è²·</span>
        </button>
        <button onclick="switchTab('budget')" id="btn-budget" class="nav-item flex flex-col items-center w-1/4">
            <i class="fa-solid fa-wallet text-lg mb-1"></i>
            <span class="text-[10px] font-bold">è¨˜å¸³</span>
        </button>
        <button onclick="switchTab('info')" id="btn-info" class="nav-item flex flex-col items-center w-1/4">
            <i class="fa-solid fa-suitcase text-lg mb-1"></i>
            <span class="text-[10px] font-bold">è³‡è¨Š</span>
        </button>
    </div>

    <script>
        // --- å…¨åŸŸè®Šæ•¸ ---
        let currentRole = localStorage.getItem('user_role'); // driver, copilot, tourist, admin
        let currentSimulatedDate = null;
        const JPY_RATE = 0.22;

        // --- è³‡æ–™åº« (æ“´å……ç‰ˆ) ---
        const tripData = [
            {
                date: "2025/12/26", day: "é€±äº”",
                events: [
                    { 
                        time: "08:00", title: "OTS ç§Ÿè»Š", type: "trans", 
                        mapCode: "232 543 502*66",
                        parking: { info: "ç¾å ´æœ‰å°ˆç”¨é‚„è»Šå€", nearby: "æ—é‚Šæœ‰åŠ æ²¹ç«™" },
                        rating: 4.8, reviewCount: 2500,
                        imgUrl: "https://images.unsplash.com/photo-1449965408869-eaa3f722e40d?w=500", // ç¤ºæ„åœ–
                        guide: "è¨˜å¾—å…ˆæª¢æŸ¥è»Šèº«åˆ®ç—•ä¸¦æ‹ç…§ã€‚å³é§•å£è¨£ï¼šé å·¦é–‹ï¼Œé›¨åˆ·åœ¨å·¦ï¼Œæ–¹å‘ç‡ˆåœ¨å³ã€‚",
                        adminNote: "å–è»Šå–®è™Ÿåœ¨ Emailï¼Œè¨˜å¾—å‡ºç¤ºé§•ç…§+è­¯æœ¬ã€‚é è¨ˆ 9:30 å‡ºç™¼ã€‚",
                        decision: "å¦‚æœäººå¤ªå¤šï¼Œçˆ¸çˆ¸å…ˆå¸¶åª½åª½å»æ—é‚Šä¾¿åˆ©å•†åº—è²·å’–å•¡ã€‚"
                    },
                    { 
                        time: "11:00", title: "æ¸¯å·å¤–äººå±…ä½å®…", type: "spot", 
                        mapCode: "33 341 063*55",
                        parking: { info: "åº—é‹ªå‰åƒ…1-2æ ¼", nearby: "å»ºè­°åœå¤–é¢ä»˜è²»åœè»Šå ´ (300å††/hr)" },
                        rating: 4.4, reviewCount: 1800,
                        imgUrl: "https://images.unsplash.com/photo-1516483638261-f4dbaf036963?w=500",
                        guide: "å‰ç¾è»å®¿èˆæ”¹å»ºçš„æ–‡é’èšè½ï¼Œæ¯é–“æˆ¿å­é¡è‰²éƒ½ä¸åŒï¼Œè¶…å¥½æ‹ï¼å¿…è²· O'Hacorte æ°´æœå¡”ã€‚",
                        adminNote: "åœç•™ 1 å°æ™‚ï¼Œ12:00 å¿…é ˆé›¢é–‹å‰å¾€æ™®å¤©æ»¿å®®ã€‚",
                        decision: "å¦‚æœæ²’è»Šä½ï¼Œç›´æ¥å°èˆªå»é™„è¿‘çš„ã€Œã‚³ã‚¤ãƒ³ãƒ‘ãƒ¼ã‚­ãƒ³ã‚°ã€ã€‚"
                    },
                    { 
                        time: "14:30", title: "å£½å¸å¸‚å ´ æ³¡ç€¨åº—", type: "eat", 
                        mapCode: "33 531 366*44",
                        parking: { info: "åº—å‰æœ‰å…è²»å¤§åœè»Šå ´", nearby: "" },
                        rating: 4.2, reviewCount: 900,
                        imgUrl: "https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=500",
                        reservation: "åªèƒ½ç¾å ´æ’",
                        guide: "ç¾åœ‹æ‘é™„è¿‘çš„è¿´è½‰å£½å¸ï¼ŒCPå€¼å¾ˆé«˜ï¼Œæ¨è–¦ç‚™ç‡’ç³»åˆ—ã€‚",
                        menu: [{n:"ç‚™ç‡’é®­é­š", j:"ç‚™ã‚Šã‚µãƒ¼ãƒ¢ãƒ³"}, {n:"é®ªé­šå¤§è…¹", j:"å¤§ãƒˆãƒ­"}],
                        adminNote: "è¨˜å¾—å‡ºç¤ºæ‰‹æ©Ÿè£¡çš„ã€Œå…è²»å‘³å™Œæ¹¯ã€æˆªåœ–ã€‚",
                        decision: "å¦‚æœè¦æ’è¶…é 30 åˆ†é˜ï¼Œæ”¹å»æ—é‚Šåƒ A&W æ¼¢å ¡ã€‚"
                    }
                ]
            },
            {
                date: "2025/12/27", day: "é€±å…­",
                events: [
                    { 
                        time: "11:00", title: "å¤å®‡åˆ©å³¶ è¦è¦é£¯", type: "eat", 
                        mapCode: "485 692 167*55",
                        parking: { info: "å°ˆç”¨åœè»Šå ´ (å…è²»)", nearby: "P1æ»¿äº†è«‹å¾€ä¸Šé–‹åˆ°P2" },
                        rating: 4.3, reviewCount: 3200,
                        imgUrl: "https://images.unsplash.com/photo-1625937759422-bb2ba795ae06?w=500",
                        guide: "æ²–ç¹©ç¶²ç´…ååº—ï¼äºŒæ¨“åº§ä½å€å¯ä»¥çœ‹åˆ°å¤å®‡åˆ©å¤§æ©‹æµ·æ™¯ã€‚",
                        menu: [{n:"åŸå‘³å¤§è’œè¦é£¯", j:"ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚¬ãƒ¼ãƒªãƒƒã‚¯ã‚·ãƒ¥ãƒªãƒ³ãƒ—"}, {n:"è¾£å‘³å¤§è’œè¦é£¯", j:"ã‚¹ãƒ‘ã‚¤ã‚·ãƒ¼ã‚¬ãƒ¼ãƒªãƒƒã‚¯ã‚·ãƒ¥ãƒªãƒ³ãƒ—"}],
                        adminNote: "é€™é‚Šäººå¤šï¼Œæˆ‘å…ˆå»é»é¤ï¼Œå¦¹å¦¹å»åœè»Šã€‚",
                        decision: "è‹¥ä¸‹å¤§é›¨ï¼Œæ”¹å¤–å¸¶åœ¨è»Šä¸Šåƒã€‚"
                    },
                    { 
                        time: "13:20", title: "ç¾éº—æµ·æ°´æ—é¤¨", type: "spot", 
                        mapCode: "553 075 797*77",
                        parking: { info: "P7ç«‹é«”åœè»Šå ´ (æœ€è¿‘)", nearby: "P7æ»¿äº†è«‹åœP6" },
                        rating: 4.7, reviewCount: 45000,
                        imgUrl: "https://images.unsplash.com/photo-1544551763-46a8723ba3f9?w=500",
                        guide: "å¿…çœ‹ï¼š15:00 / 17:00 çš„é¯¨é¯Šé¤µé£Ÿç§€ã€‚è¨˜å¾—å»æˆ¶å¤–çš„æµ·é¾œé¤¨å’Œæµ·ç‰›é¤¨ï¼ˆå…è²»ï¼‰ã€‚",
                        adminNote: "é–€ç¥¨å·²åœ¨è¨±ç”°è²·å¥½ã€‚16:30 é›†åˆå»åƒç‡’è‚‰ã€‚",
                        decision: "å¦‚æœä¸çœ‹æµ·è±šç§€ï¼Œå¯ä»¥å¤šé€›ä¸€ä¸‹ç´€å¿µå“åº—ã€‚"
                    }
                ]
            }
        ];

        // é è¨­å¾…è²·æ¸…å–®
        const defaultShopping = [
            { id: 1, store: "è—¥å¦åº—", item: "EVEæ­¢ç—›è—¥", priceJp: 980, qty: 2, pay: "ä¿¡ç”¨å¡", done: false },
            { id: 2, store: "è¶…å¸‚", item: "æ—¥æ¸…ç‚¸é›ç²‰", priceJp: 120, qty: 5, pay: "ç¾é‡‘", done: false },
            { id: 3, store: "æ©Ÿå ´", item: "é›ªé¹½é¤…ä¹¾", priceJp: 1000, qty: 3, pay: "è¥¿ç“œå¡", done: false }
        ];

        // --- æ ¸å¿ƒé‚è¼¯ ---

        function init() {
            if (!currentRole) {
                document.getElementById('role-selector').classList.remove('hidden');
                document.getElementById('role-selector').classList.add('flex');
            } else {
                updateRoleUI();
                renderHome();
            }
        }

        function selectRole(role) {
            currentRole = role;
            localStorage.setItem('user_role', role);
            document.getElementById('role-selector').classList.add('hidden');
            document.getElementById('role-selector').classList.remove('flex');
            updateRoleUI();
            renderHome();
        }

        function clearRole() {
            localStorage.removeItem('user_role');
            currentRole = null;
            location.reload();
        }

        function updateRoleUI() {
            // æ ¹æ“šè§’è‰²æ›´æ–°æ¨™é¡Œæ—çš„ Badge
            const badge = document.getElementById('current-role-badge');
            const map = { 'driver': 'ğŸš— å¦¹å¦¹', 'copilot': 'ğŸ—ºï¸ çˆ¸çˆ¸', 'tourist': 'ğŸ“¸ åª½åª½', 'admin': 'ğŸ“ æˆ‘' };
            badge.innerText = `ç›®å‰ï¼š${map[currentRole]} (æ›)`;
        }

        function toggleDevMode() {
            if(!currentSimulatedDate) {
                currentSimulatedDate = "2025-12-27 11:30";
                alert("æ¨¡æ“¬æ¨¡å¼ï¼šè¨­å®šæ™‚é–“ç‚º 12/27 11:3
